(()=>{"use strict";const e=new Map;function t(e){return Array.isArray(e)?e.map((e=>e.split(":"))):[e.split(":")]}function i(e){const t=g,i=[e].flatMap((e=>{const[i,r,s]=e;if(!(i in f))return[e];if(!i&&!r&&!s)return[e];const n=f[i].map((e=>[e,r,s]));return void 0===r||r in _&&(r||s)?n:n.filter((([e])=>!!t[e]?.[r]))})).flatMap((e=>{const[i,r,s]=e;if(!(r in _))return[e];if(!r&&!s)return[e];const n=_[r].map((e=>[i,e,s]));return void 0===s?n:n.filter((([,e])=>!!t[i]?.[e]?.[s]))}));if(0===i.length)throw new Error(`Shortcuts in '${e.join(":")}' do not expand to any valid filter query`);return i}function r(e){const[t,i,r,...s]=e;if(void 0===t)return"Empty filter query given";if(!(t in g)&&"chat_boost"!==t&&"removed_chat_boost"!==t){const i=Object.keys(g);return`Invalid L1 filter '${t}' given in '${e.join(":")}'. Permitted values are: ${i.map((e=>`'${e}'`)).join(", ")}.`}if(void 0===i)return!0;const n=g[t];if(!(i in n)){const t=Object.keys(n);return`Invalid L2 filter '${i}' given in '${e.join(":")}'. Permitted values are: ${t.map((e=>`'${e}'`)).join(", ")}.`}if(void 0===r)return!0;const a=n[i];if(!(r in a)){const s=Object.keys(a);return`Invalid L3 filter '${r}' given in '${e.join(":")}'. ${0===s.length?`No further filtering is possible after '${t}:${i}'.`:`Permitted values are: ${s.map((e=>`'${e}'`)).join(", ")}.`}`}return 0===s.length||`Cannot filter further than three levels, ':${s.join(":")}' is invalid!`}function s(e,t){return(i,r)=>e(i,r)||t(i,r)}function n(e,t){return(i,r)=>{const s=e(i,r);return s&&t(s,r)}}function a(e){return(t,i)=>null!=e(t,i)}function o(e,t){const i=e=>null!=e&&t(e);return Array.isArray(e)?e.some(i):i(e)}const h={mention:{},hashtag:{},cashtag:{},bot_command:{},url:{},email:{},phone_number:{},bold:{},italic:{},underline:{},strikethrough:{},spoiler:{},code:{},pre:{},text_link:{},text_mention:{},custom_emoji:{}},c={me:{},is_bot:{},is_premium:{},added_to_attachment_menu:{}},u={emoji:{},custom_emoji:{}},d={forward_origin:{user:{},hidden_user:{},chat:{},channel:{}},is_topic_message:{},is_automatic_forward:{},text:{},animation:{},audio:{},document:{},photo:{},sticker:{is_video:{},is_animated:{},premium_animation:{}},story:{},video:{},video_note:{},voice:{},contact:{},dice:{},game:{},poll:{},venue:{},location:{},entities:h,caption_entities:h,caption:{},has_media_spoiler:{},new_chat_title:{},new_chat_photo:{},delete_chat_photo:{},message_auto_delete_timer_changed:{},pinned_message:{},invoice:{},proximity_alert_triggered:{},video_chat_scheduled:{},video_chat_started:{},video_chat_ended:{},video_chat_participants_invited:{},web_app_data:{}},l={...d,new_chat_members:c,left_chat_member:c,group_chat_created:{},supergroup_chat_created:{},migrate_to_chat_id:{},migrate_from_chat_id:{},successful_payment:{},users_shared:{},chat_shared:{},connected_website:{},write_access_allowed:{},passport_data:{},forum_topic_created:{},forum_topic_edited:{name:{},icon_custom_emoji_id:{}},forum_topic_closed:{},forum_topic_reopened:{},general_forum_topic_hidden:{},general_forum_topic_unhidden:{}},m={...d,channel_chat_created:{}},p={from:c},g={message:l,edited_message:l,channel_post:m,edited_channel_post:m,inline_query:{},chosen_inline_result:{},callback_query:{data:{},game_short_name:{}},shipping_query:{},pre_checkout_query:{},poll:{},poll_answer:{},my_chat_member:p,chat_member:p,chat_join_request:{},message_reaction:{old_reaction:u,new_reaction:u},message_reaction_count:{reactions:u}},f={"":["message","channel_post"],msg:["message","channel_post"],edit:["edited_message","edited_channel_post"]},_={"":["entities","caption_entities"],media:["photo","video"],file:["photo","animation","audio","document","video","video_note","voice","sticker"]},y={filterQuery(h){const c=function(h){const c=Array.isArray(h)?h:[h],u=c.join(","),d=e.get(u)??(()=>{const h=function(e){const t=function(e){const t=Object.entries(e).map((([e,t])=>{const i=t=>t[e],r=Object.entries(t).map((([e,t])=>{const i=t=>t[e],r=Array.from(t).map((e=>"me"===e?(e,t)=>{const i=t.me.id;return o(e,(e=>e.id===i))}:t=>o(t,(t=>t[e]||t.type===e))));return 0===r.length?a(i):n(i,r.reduce(s))}));return 0===r.length?a(i):n(i,r.reduce(s))}));if(0===t.length)throw new Error("Cannot create filter function for empty query");return t.reduce(s)}(function(e){const t={};for(const[i,r,s]of e){const e=t[i]??={};if(void 0!==r){const t=e[r]??=new Set;void 0!==s&&t.add(s)}}return t}(e.flatMap((e=>function(e,t){if(0===t.length)throw new Error("Empty filter query given");const i=t.map(r).filter((e=>!0!==e));if(0===i.length)return t;throw 1===i.length?new Error(i[0]):new Error(`Invalid filter query '${e.join(":")}'. There are ${i.length} errors after expanding the contained shortcuts: ${i.join("; ")}`)}(e,i(e))))));return e=>!!t(e.update,e)}(t(c));return e.set(u,h),h})();return e=>d(e)}(h);return e=>c(e)},text(e){const t=y.filterQuery([":text",":caption"]),i=b(e);return e=>{if(!t(e))return!1;const r=e.message??e.channelPost;return M(e,r.text??r.caption,i)}},command(e){const t=y.filterQuery(":entities:bot_command"),i=new Set,r=new Set;return v(e).forEach((e=>{if(e.startsWith("/"))throw new Error(`Do not include '/' when registering command handlers (use '${e.substring(1)}' not '${e}')`);(e.includes("@")?i:r).add(e)})),e=>{if(!t(e))return!1;const s=e.message??e.channelPost,n=s.text??s.caption;return s.entities.some((t=>{if("bot_command"!==t.type)return!1;if(0!==t.offset)return!1;const s=n.substring(1,t.length);if(r.has(s)||i.has(s))return e.match=n.substring(s.length+1).trimStart(),!0;const a=s.indexOf("@");if(-1===a)return!1;if(s.substring(a+1).toLowerCase()!==e.me.username.toLowerCase())return!1;const o=s.substring(0,a);return!!r.has(o)&&(e.match=n.substring(s.length+1).trimStart(),!0)}))}},reaction(e){const t=y.filterQuery("message_reaction"),i="string"==typeof e?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{type:"emoji",emoji:e}:e));return e=>{if(!t(e))return!1;const{old_reaction:r,new_reaction:s}=e.messageReaction;for(const e of s){let t=!1;if("emoji"===e.type){for(const i of r)if("emoji"===i.type&&i.emoji===e.emoji){t=!0;break}}else if("custom_emoji"===e.type)for(const i of r)if("custom_emoji"===i.type&&i.custom_emoji_id===e.custom_emoji_id){t=!0;break}if(!t)if("emoji"===e.type){for(const t of i)if("emoji"===t.type&&t.emoji===e.emoji)return!0}else{if("custom_emoji"!==e.type)return!0;for(const t of i)if("custom_emoji"===t.type&&t.custom_emoji_id===e.custom_emoji_id)return!0}}return!1}},chatType(e){const t=new Set(v(e));return e=>void 0!==e.chat?.type&&t.has(e.chat.type)},callbackQuery(e){const t=y.filterQuery("callback_query:data"),i=b(e);return e=>t(e)&&M(e,e.callbackQuery.data,i)},gameQuery(e){const t=y.filterQuery("callback_query:game_short_name"),i=b(e);return e=>t(e)&&M(e,e.callbackQuery.game_short_name,i)},inlineQuery(e){const t=y.filterQuery("inline_query"),i=b(e);return e=>t(e)&&M(e,e.inlineQuery.query,i)},chosenInlineResult(e){const t=y.filterQuery("chosen_inline_result"),i=b(e);return e=>t(e)&&M(e,e.chosenInlineResult.result_id,i)}};class w{update;api;me;match;constructor(e,t,i){this.update=e,this.api=t,this.me=i}get message(){return this.update.message}get editedMessage(){return this.update.edited_message}get channelPost(){return this.update.channel_post}get editedChannelPost(){return this.update.edited_channel_post}get messageReaction(){return this.update.message_reaction}get messageReactionCount(){return this.update.message_reaction_count}get inlineQuery(){return this.update.inline_query}get chosenInlineResult(){return this.update.chosen_inline_result}get callbackQuery(){return this.update.callback_query}get shippingQuery(){return this.update.shipping_query}get preCheckoutQuery(){return this.update.pre_checkout_query}get poll(){return this.update.poll}get pollAnswer(){return this.update.poll_answer}get myChatMember(){return this.update.my_chat_member}get chatMember(){return this.update.chat_member}get chatJoinRequest(){return this.update.chat_join_request}get chatBoost(){return this.update.chat_boost}get removedChatBoost(){return this.update.removed_chat_boost}get msg(){return this.message??this.editedMessage??this.callbackQuery?.message??this.channelPost??this.editedChannelPost}get chat(){return(this.msg??this.messageReaction??this.messageReactionCount??this.myChatMember??this.chatMember??this.chatJoinRequest??this.chatBoost??this.removedChatBoost)?.chat}get senderChat(){return this.msg?.sender_chat}get from(){return this.messageReaction?.user??(this.callbackQuery??this.inlineQuery??this.shippingQuery??this.preCheckoutQuery??this.chosenInlineResult??this.msg??this.myChatMember??this.chatMember??this.chatJoinRequest)?.from}get inlineMessageId(){return this.callbackQuery?.inline_message_id??this.chosenInlineResult?.inline_message_id}entities(e){const t=this.msg;if(void 0===t)return[];const i=t.text??t.caption;if(void 0===i)return[];let r=t.entities??t.caption_entities;if(void 0===r)return[];if(void 0!==e){const t=new Set(v(e));r=r.filter((e=>t.has(e.type)))}return r.map((e=>({...e,text:i.substring(e.offset,e.offset+e.length)})))}reactions(){const e=[],t=[],i=[],r=[],s=[],n=[],a=[],o=[],h=this.messageReaction;if(void 0!==h){const{old_reaction:c,new_reaction:u}=h;for(const t of u)"emoji"===t.type?e.push(t.emoji):"custom_emoji"===t.type&&s.push(t.custom_emoji_id);for(const e of c)"emoji"===e.type?r.push(e.emoji):"custom_emoji"===e.type&&o.push(e.custom_emoji_id);t.push(...e),n.push(...s);for(let e=0;e<r.length;e++){const s=t.length;if(0===s)break;const n=r[e];for(let a=0;a<s;a++)if(n===t[a]){i.push(n),r.splice(e,1),t.splice(a,1),e--;break}}for(let e=0;e<o.length;e++){const t=n.length;if(0===t)break;const i=o[e];for(let r=0;r<t;r++)if(i===n[r]){a.push(i),o.splice(e,1),n.splice(r,1),e--;break}}}return{emoji:e,emojiAdded:t,emojiKept:i,emojiRemoved:r,customEmoji:s,customEmojiAdded:n,customEmojiKept:a,customEmojiRemoved:o}}static has=y;has(e){return w.has.filterQuery(e)(this)}hasText(e){return w.has.text(e)(this)}hasCommand(e){return w.has.command(e)(this)}hasReaction(e){return w.has.reaction(e)(this)}hasChatType(e){return w.has.chatType(e)(this)}hasCallbackQuery(e){return w.has.callbackQuery(e)(this)}hasGameQuery(e){return w.has.gameQuery(e)(this)}hasInlineQuery(e){return w.has.inlineQuery(e)(this)}hasChosenInlineResult(e){return w.has.chosenInlineResult(e)(this)}reply(e,t,i){return this.api.sendMessage(C(this.chat,"sendMessage").id,e,t,i)}forwardMessage(e,t,i){return this.api.forwardMessage(e,C(this.chat,"forwardMessage").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"forwardMessage"),t,i)}forwardMessages(e,t,i,r){return this.api.forwardMessages(e,C(this.chat,"forwardMessages").id,t,i,r)}copyMessage(e,t,i){return this.api.copyMessage(e,C(this.chat,"copyMessage").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"copyMessage"),t,i)}copyMessages(e,t,i,r){return this.api.copyMessages(e,C(this.chat,"copyMessages").id,t,i,r)}replyWithPhoto(e,t,i){return this.api.sendPhoto(C(this.chat,"sendPhoto").id,e,t,i)}replyWithAudio(e,t,i){return this.api.sendAudio(C(this.chat,"sendAudio").id,e,t,i)}replyWithDocument(e,t,i){return this.api.sendDocument(C(this.chat,"sendDocument").id,e,t,i)}replyWithVideo(e,t,i){return this.api.sendVideo(C(this.chat,"sendVideo").id,e,t,i)}replyWithAnimation(e,t,i){return this.api.sendAnimation(C(this.chat,"sendAnimation").id,e,t,i)}replyWithVoice(e,t,i){return this.api.sendVoice(C(this.chat,"sendVoice").id,e,t,i)}replyWithVideoNote(e,t,i){return this.api.sendVideoNote(C(this.chat,"sendVideoNote").id,e,t,i)}replyWithMediaGroup(e,t,i){return this.api.sendMediaGroup(C(this.chat,"sendMediaGroup").id,e,t,i)}replyWithLocation(e,t,i,r){return this.api.sendLocation(C(this.chat,"sendLocation").id,e,t,i,r)}editMessageLiveLocation(e,t,i,r){const s=this.inlineMessageId;return void 0!==s?this.api.editMessageLiveLocationInline(s,e,t,i):this.api.editMessageLiveLocation(C(this.chat,"editMessageLiveLocation").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageLiveLocation"),e,t,i,r)}stopMessageLiveLocation(e,t){const i=this.inlineMessageId;return void 0!==i?this.api.stopMessageLiveLocationInline(i,e):this.api.stopMessageLiveLocation(C(this.chat,"stopMessageLiveLocation").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"stopMessageLiveLocation"),e,t)}replyWithVenue(e,t,i,r,s,n){return this.api.sendVenue(C(this.chat,"sendVenue").id,e,t,i,r,s,n)}replyWithContact(e,t,i,r){return this.api.sendContact(C(this.chat,"sendContact").id,e,t,i,r)}replyWithPoll(e,t,i,r){return this.api.sendPoll(C(this.chat,"sendPoll").id,e,t,i,r)}replyWithDice(e,t,i){return this.api.sendDice(C(this.chat,"sendDice").id,e,t,i)}react(e,t,i){return this.api.setMessageReaction(C(this.chat,"setMessageReaction").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"setMessageReaction"),"string"==typeof e?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{type:"emoji",emoji:e}:e)),t,i)}replyWithChatAction(e,t,i){return this.api.sendChatAction(C(this.chat,"sendChatAction").id,e,t,i)}getUserProfilePhotos(e,t){return this.api.getUserProfilePhotos(C(this.from,"getUserProfilePhotos").id,e,t)}getUserChatBoosts(e,t){return this.api.getUserChatBoosts(e,C(this.from,"getUserChatBoosts").id,t)}getFile(e){const t=C(this.msg,"getFile"),i=void 0!==t.photo?t.photo[t.photo.length-1]:t.animation??t.audio??t.document??t.video??t.video_note??t.voice??t.sticker;return this.api.getFile(C(i,"getFile").file_id,e)}kickAuthor(...e){return this.banAuthor(...e)}banAuthor(e,t){return this.api.banChatMember(C(this.chat,"banAuthor").id,C(this.from,"banAuthor").id,e,t)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,t,i){return this.api.banChatMember(C(this.chat,"banChatMember").id,e,t,i)}unbanChatMember(e,t,i){return this.api.unbanChatMember(C(this.chat,"unbanChatMember").id,e,t,i)}restrictAuthor(e,t,i){return this.api.restrictChatMember(C(this.chat,"restrictAuthor").id,C(this.from,"restrictAuthor").id,e,t,i)}restrictChatMember(e,t,i,r){return this.api.restrictChatMember(C(this.chat,"restrictChatMember").id,e,t,i,r)}promoteAuthor(e,t){return this.api.promoteChatMember(C(this.chat,"promoteAuthor").id,C(this.from,"promoteAuthor").id,e,t)}promoteChatMember(e,t,i){return this.api.promoteChatMember(C(this.chat,"promoteChatMember").id,e,t,i)}setChatAdministratorAuthorCustomTitle(e,t){return this.api.setChatAdministratorCustomTitle(C(this.chat,"setChatAdministratorAuthorCustomTitle").id,C(this.from,"setChatAdministratorAuthorCustomTitle").id,e,t)}setChatAdministratorCustomTitle(e,t,i){return this.api.setChatAdministratorCustomTitle(C(this.chat,"setChatAdministratorCustomTitle").id,e,t,i)}banChatSenderChat(e,t){return this.api.banChatSenderChat(C(this.chat,"banChatSenderChat").id,e,t)}unbanChatSenderChat(e,t){return this.api.unbanChatSenderChat(C(this.chat,"unbanChatSenderChat").id,e,t)}setChatPermissions(e,t){return this.api.setChatPermissions(C(this.chat,"setChatPermissions").id,e,t)}exportChatInviteLink(e){return this.api.exportChatInviteLink(C(this.chat,"exportChatInviteLink").id,e)}createChatInviteLink(e,t){return this.api.createChatInviteLink(C(this.chat,"createChatInviteLink").id,e,t)}editChatInviteLink(e,t,i){return this.api.editChatInviteLink(C(this.chat,"editChatInviteLink").id,e,t,i)}revokeChatInviteLink(e,t){return this.api.revokeChatInviteLink(C(this.chat,"editChatInviteLink").id,e,t)}approveChatJoinRequest(e,t){return this.api.approveChatJoinRequest(C(this.chat,"approveChatJoinRequest").id,e,t)}declineChatJoinRequest(e,t){return this.api.declineChatJoinRequest(C(this.chat,"declineChatJoinRequest").id,e,t)}setChatPhoto(e,t){return this.api.setChatPhoto(C(this.chat,"setChatPhoto").id,e,t)}deleteChatPhoto(e){return this.api.deleteChatPhoto(C(this.chat,"deleteChatPhoto").id,e)}setChatTitle(e,t){return this.api.setChatTitle(C(this.chat,"setChatTitle").id,e,t)}setChatDescription(e,t){return this.api.setChatDescription(C(this.chat,"setChatDescription").id,e,t)}pinChatMessage(e,t,i){return this.api.pinChatMessage(C(this.chat,"pinChatMessage").id,e,t,i)}unpinChatMessage(e,t){return this.api.unpinChatMessage(C(this.chat,"unpinChatMessage").id,e,t)}unpinAllChatMessages(e){return this.api.unpinAllChatMessages(C(this.chat,"unpinAllChatMessages").id,e)}leaveChat(e){return this.api.leaveChat(C(this.chat,"leaveChat").id,e)}getChat(e){return this.api.getChat(C(this.chat,"getChat").id,e)}getChatAdministrators(e){return this.api.getChatAdministrators(C(this.chat,"getChatAdministrators").id,e)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e){return this.api.getChatMemberCount(C(this.chat,"getChatMemberCount").id,e)}getAuthor(e){return this.api.getChatMember(C(this.chat,"getAuthor").id,C(this.from,"getAuthor").id,e)}getChatMember(e,t){return this.api.getChatMember(C(this.chat,"getChatMember").id,e,t)}setChatStickerSet(e,t){return this.api.setChatStickerSet(C(this.chat,"setChatStickerSet").id,e,t)}deleteChatStickerSet(e){return this.api.deleteChatStickerSet(C(this.chat,"deleteChatStickerSet").id,e)}createForumTopic(e,t,i){return this.api.createForumTopic(C(this.chat,"createForumTopic").id,e,t,i)}editForumTopic(e,t){const i=C(this.msg,"editForumTopic"),r=C(i.message_thread_id,"editForumTopic");return this.api.editForumTopic(i.chat.id,r,e,t)}closeForumTopic(e){const t=C(this.msg,"closeForumTopic"),i=C(t.message_thread_id,"closeForumTopic");return this.api.closeForumTopic(t.chat.id,i,e)}reopenForumTopic(e){const t=C(this.msg,"reopenForumTopic"),i=C(t.message_thread_id,"reopenForumTopic");return this.api.reopenForumTopic(t.chat.id,i,e)}deleteForumTopic(e){const t=C(this.msg,"deleteForumTopic"),i=C(t.message_thread_id,"deleteForumTopic");return this.api.deleteForumTopic(t.chat.id,i,e)}unpinAllForumTopicMessages(e){const t=C(this.msg,"unpinAllForumTopicMessages"),i=C(t.message_thread_id,"unpinAllForumTopicMessages");return this.api.unpinAllForumTopicMessages(t.chat.id,i,e)}editGeneralForumTopic(e,t){return this.api.editGeneralForumTopic(C(this.chat,"editGeneralForumTopic").id,e,t)}closeGeneralForumTopic(e){return this.api.closeGeneralForumTopic(C(this.chat,"closeGeneralForumTopic").id,e)}reopenGeneralForumTopic(e){return this.api.reopenGeneralForumTopic(C(this.chat,"reopenGeneralForumTopic").id,e)}hideGeneralForumTopic(e){return this.api.hideGeneralForumTopic(C(this.chat,"hideGeneralForumTopic").id,e)}unhideGeneralForumTopic(e){return this.api.unhideGeneralForumTopic(C(this.chat,"unhideGeneralForumTopic").id,e)}unpinAllGeneralForumTopicMessages(e){return this.api.unpinAllGeneralForumTopicMessages(C(this.chat,"unpinAllGeneralForumTopicMessages").id,e)}answerCallbackQuery(e,t){return this.api.answerCallbackQuery(C(this.callbackQuery,"answerCallbackQuery").id,"string"==typeof e?{text:e}:e,t)}setChatMenuButton(e,t){return this.api.setChatMenuButton(e,t)}getChatMenuButton(e,t){return this.api.getChatMenuButton(e,t)}setMyDefaultAdministratorRights(e,t){return this.api.setMyDefaultAdministratorRights(e,t)}getMyDefaultAdministratorRights(e,t){return this.api.getMyDefaultAdministratorRights(e,t)}editMessageText(e,t,i){const r=this.inlineMessageId;return void 0!==r?this.api.editMessageTextInline(r,e,t):this.api.editMessageText(C(this.chat,"editMessageText").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageText"),e,t,i)}editMessageCaption(e,t){const i=this.inlineMessageId;return void 0!==i?this.api.editMessageCaptionInline(i,e):this.api.editMessageCaption(C(this.chat,"editMessageCaption").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageCaption"),e,t)}editMessageMedia(e,t,i){const r=this.inlineMessageId;return void 0!==r?this.api.editMessageMediaInline(r,e,t):this.api.editMessageMedia(C(this.chat,"editMessageMedia").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageMedia"),e,t,i)}editMessageReplyMarkup(e,t){const i=this.inlineMessageId;return void 0!==i?this.api.editMessageReplyMarkupInline(i,e):this.api.editMessageReplyMarkup(C(this.chat,"editMessageReplyMarkup").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageReplyMarkup"),e,t)}stopPoll(e,t){return this.api.stopPoll(C(this.chat,"stopPoll").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"stopPoll"),e,t)}deleteMessage(e){return this.api.deleteMessage(C(this.chat,"deleteMessage").id,C(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"deleteMessage"),e)}deleteMessages(e,t){return this.api.deleteMessages(C(this.chat,"deleteMessages").id,e,t)}replyWithSticker(e,t,i){return this.api.sendSticker(C(this.chat,"sendSticker").id,e,t,i)}getCustomEmojiStickers(e){return this.api.getCustomEmojiStickers((this.msg?.entities??[]).filter((e=>"custom_emoji"===e.type)).map((e=>e.custom_emoji_id)),e)}answerInlineQuery(e,t,i){return this.api.answerInlineQuery(C(this.inlineQuery,"answerInlineQuery").id,e,t,i)}replyWithInvoice(e,t,i,r,s,n,a,o){return this.api.sendInvoice(C(this.chat,"sendInvoice").id,e,t,i,r,s,n,a,o)}answerShippingQuery(e,t,i){return this.api.answerShippingQuery(C(this.shippingQuery,"answerShippingQuery").id,e,t,i)}answerPreCheckoutQuery(e,t,i){return this.api.answerPreCheckoutQuery(C(this.preCheckoutQuery,"answerPreCheckoutQuery").id,e,"string"==typeof t?{error_message:t}:t,i)}setPassportDataErrors(e,t){return this.api.setPassportDataErrors(C(this.from,"setPassportDataErrors").id,e,t)}replyWithGame(e,t,i){return this.api.sendGame(C(this.chat,"sendGame").id,e,t,i)}}function C(e,t){if(void 0===e)throw new Error(`Missing information for API call to ${t}`);return e}function b(e){return v(e).map((e=>"string"==typeof e?t=>t===e?e:null:t=>t.match(e)))}function M(e,t,i){for(const r of i){const i=r(t);if(i)return e.match=i,!0}return!1}function v(e){return Array.isArray(e)?e:[e]}class k extends Error{error;ctx;constructor(e,t){super(function(e){let t;if(e instanceof Error)t=`${e.name} in middleware: ${e.message}`;else{const i=typeof e;switch(t=`Non-error value of type ${i} thrown in middleware`,i){case"bigint":case"boolean":case"number":case"symbol":t+=`: ${e}`;break;case"string":t+=`: ${String(e).substring(0,50)}`;break;default:t+="!"}}return t}(e)),this.error=e,this.ctx=t,this.name="BotError",e instanceof Error&&(this.stack=e.stack)}}function T(e){return"function"==typeof e?e:(t,i)=>e.middleware()(t,i)}function F(e,t){return async(i,r)=>{let s=!1;await e(i,(async()=>{if(s)throw new Error("`next` already called before!");s=!0,await t(i,r)}))}}function S(e,t){return t()}const A=()=>Promise.resolve();async function R(e,t){await e(t,A)}class I{handler;constructor(...e){this.handler=0===e.length?S:e.map(T).reduce(F)}middleware(){return this.handler}use(...e){const t=new I(...e);return this.handler=F(this.handler,T(t)),t}on(e,...t){return this.filter(w.has.filterQuery(e),...t)}hears(e,...t){return this.filter(w.has.text(e),...t)}command(e,...t){return this.filter(w.has.command(e),...t)}reaction(e,...t){return this.filter(w.has.reaction(e),...t)}chatType(e,...t){return this.filter(w.has.chatType(e),...t)}callbackQuery(e,...t){return this.filter(w.has.callbackQuery(e),...t)}gameQuery(e,...t){return this.filter(w.has.gameQuery(e),...t)}inlineQuery(e,...t){return this.filter(w.has.inlineQuery(e),...t)}chosenInlineResult(e,...t){return this.filter(w.has.chosenInlineResult(e),...t)}filter(e,...t){const i=new I(...t);return this.branch(e,i,S),i}drop(e,...t){return this.filter((async t=>!await e(t)),...t)}fork(...e){const t=new I(...e),i=T(t);return this.use(((e,t)=>Promise.all([t(),R(i,e)]))),t}lazy(e){return this.use((async(t,i)=>{const r=await e(t),s=Array.isArray(r)?r:[r];await T(new I(...s))(t,i)}))}route(e,t,i=S){return this.lazy((async r=>{const s=await e(r);return(void 0!==s&&t[s]?t[s]:i)??[]}))}branch(e,t,i){return this.lazy((async r=>await e(r)?t:i))}errorBoundary(e,...t){const i=new I(...t),r=T(i);return this.use((async(t,i)=>{let s=!1;const n=()=>(s=!0,Promise.resolve());try{await r(t,n)}catch(i){s=!1,await e(new k(i,t),n)}s&&await i()})),i}}var j=1e3,P=60*j,L=60*P,E=24*L,x=function(e,t){t=t||{};var i,r,s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*E;case"hours":case"hour":case"hrs":case"hr":case"h":return i*L;case"minutes":case"minute":case"mins":case"min":case"m":return i*P;case"seconds":case"second":case"secs":case"sec":case"s":return i*j;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?(i=e,(r=Math.abs(i))>=E?$(i,r,E,"day"):r>=L?$(i,r,L,"hour"):r>=P?$(i,r,P,"minute"):r>=j?$(i,r,j,"second"):i+" ms"):function(e){var t=Math.abs(e);return t>=E?Math.round(e/E)+"d":t>=L?Math.round(e/L)+"h":t>=P?Math.round(e/P)+"m":t>=j?Math.round(e/j)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function $(e,t,i,r){var s=t>=1.5*i;return Math.round(e/i)+" "+r+(s?"s":"")}function Q(){throw new Error("setTimeout has not been defined")}function G(){throw new Error("clearTimeout has not been defined")}var D,U=Q,q=G;function W(e){if(U===setTimeout)return setTimeout(e,0);if((U===Q||!U)&&setTimeout)return U=setTimeout,setTimeout(e,0);try{return U(e,0)}catch(t){try{return U.call(null,e,0)}catch(t){return U.call(this,e,0)}}}"function"==typeof(D="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(U=setTimeout),"function"==typeof D.clearTimeout&&(q=clearTimeout);var N,O=[],B=!1,J=-1;function V(){B&&N&&(B=!1,N.length?O=N.concat(O):J=-1,O.length&&z())}function z(){if(!B){var e=W(V);B=!0;for(var t=O.length;t;){for(N=O,O=[];++J<t;)N&&N[J].run();J=-1,t=O.length}N=null,B=!1,function(e){if(q===clearTimeout)return clearTimeout(e);if((q===G||!q)&&clearTimeout)return q=clearTimeout,clearTimeout(e);try{return q(e)}catch(t){try{return q.call(null,e)}catch(t){return q.call(this,e)}}}(e)}}function H(e,t){this.fun=e,this.array=t}function K(){}H.prototype.run=function(){this.fun.apply(null,this.array)};var Y,X,Z=K,ee=K,te=K,ie=K,re=K,se=K,ne=K,ae=D.performance||{},oe=ae.now||ae.mozNow||ae.msNow||ae.oNow||ae.webkitNow||function(){return(new Date).getTime()},he=new Date,ce={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];O.push(new H(e,t)),1!==O.length||B||W(z)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:Z,addListener:ee,once:te,off:ie,removeListener:re,removeAllListeners:se,emit:ne,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*oe.call(ae),i=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(i-=e[0],(r-=e[1])<0&&(i--,r+=1e9)),[i,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-he)/1e3}},ue=(Y=function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))})),t.splice(s,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==ce&&"env"in ce&&(e=ce.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=function(e){function t(e){let r,s,n,a=null;function o(...e){if(!o.enabled)return;const i=o,s=Number(new Date),n=s-(r||s);i.diff=n,i.prev=r,i.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,s)=>{if("%%"===r)return"%";a++;const n=t.formatters[s];if("function"==typeof n){const t=e[a];r=n.call(i,t),e.splice(a,1),a--}return r})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==t.namespaces&&(s=t.namespaces,n=t.enabled(e)),n),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,i){const r=t(this.namespace+(void 0===i?":":i)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let i;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(i=0;i<s;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let i,r;for(i=0,r=t.skips.length;i<r;i++)if(t.skips[i].test(e))return!1;for(i=0,r=t.names.length;i<r;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=x,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((i=>{t[i]=e[i]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t}(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},Y(X={path:undefined,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&X.path)}},X.exports),X.exports);ue.colors,ue.destroy,ue.formatArgs,ue.load,ue.log,ue.save,ue.storage,ue.useColors;class de extends Error{method;payload;ok;error_code;description;parameters;constructor(e,t,i,r){super(`${e} (${t.error_code}: ${t.description})`),this.method=i,this.payload=r,this.ok=!1,this.name="GrammyError",this.error_code=t.error_code,this.description=t.description,this.parameters=t.parameters??{}}}class le extends Error{error;constructor(e,t){super(e),this.error=t,this.name="HttpError"}}const me="windows"===(()=>{const{Deno:e}=globalThis;if("string"==typeof e?.build?.os)return e.build.os;const{navigator:t}=globalThis;return t?.appVersion?.includes?.("Win")?"windows":"linux"})();function pe(e,t){if(t.length>=e.length)return e;const i=e.length-t.length;for(let r=t.length-1;r>=0;--r)if(e.charCodeAt(i+r)!==t.charCodeAt(r))return e;return e.slice(0,-t.length)}function ge(e,t,i=0){let r=!1,s=e.length;for(let n=e.length-1;n>=i;--n)if(t(e.charCodeAt(n))){if(r){i=n+1;break}}else r||(r=!0,s=n+1);return e.slice(i,s)}function fe(e,t){if(function(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}(e),0===e.length)return e;if("string"!=typeof t)throw new TypeError(`Suffix must be a string. Received ${JSON.stringify(t)}`)}function _e(e,t){if(e.length<=1)return e;let i=e.length;for(let r=e.length-1;r>0&&t(e.charCodeAt(r));r--)i=r;return e.slice(0,i)}function ye(e){return 47===e}function we(e){return 47===e||92===e}function Ce(e,t=""){return me?function(e,t=""){fe(e,t);let i=0;var r;e.length>=2&&((r=e.charCodeAt(0))>=97&&r<=122||r>=65&&r<=90)&&58===e.charCodeAt(1)&&(i=2);const s=_e(ge(e,we,i),we);return t?pe(s,t):s}(e,t):function(e,t=""){fe(e,t);const i=_e(ge(e,ye),ye);return t?pe(i,t):i}(e,t)}class be{consumed=!1;fileData;filename;constructor(e,t){this.fileData=e,t??=this.guessFilename(e),this.filename=t}guessFilename(e){if("string"==typeof e)return Ce(e);if("object"==typeof e){if("url"in e)return Ce(e.url);if(e instanceof URL)return Ce(e.pathname)||Ce(e.hostname)}}toRaw(){if(this.consumed)throw new Error("Cannot reuse InputFile data source!");const e=this.fileData;return e instanceof Blob?e.stream():e instanceof URL?Me(e):"url"in e?Me(e.url):(e instanceof Uint8Array||(this.consumed=!0),e)}}async function*Me(e){const{body:t}=await fetch(e);if(null===t)throw new Error(`Download failed, no response body from '${e}'`);yield*t}function ve(e){return e instanceof be||"object"==typeof e&&null!==e&&Object.values(e).some((e=>Array.isArray(e)?e.some(ve):e instanceof be||ve(e)))}function ke(e){return JSON.stringify(e,((e,t)=>t??void 0))}function Te(e){return{method:"POST",headers:{"content-type":"application/json",connection:"keep-alive"},body:ke(e)}}function Fe(e,t){const i="----------"+Se(32),r=async function*(e,t){const i=Re(e);yield Ae.encode(`--${t}\r\n`);const r=Ae.encode(`\r\n--${t}\r\n`);let s=!0;for(const[t,i]of Object.entries(e))null!=i&&(s||(yield r),yield Ie(t,"object"==typeof i?ke(i):i),s=!1);for(const{id:e,origin:t,file:n}of i)s||(yield r),yield*je(e,t,n),s=!1;yield Ae.encode(`\r\n--${t}--\r\n`)}(e,i),s=async function*(e,t){try{yield*e}catch(e){t(e)}}(r,t),n=(e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const i=await t.next();i.done?e.close():e.enqueue(i.value)}})})(s);return{method:"POST",headers:{"content-type":`multipart/form-data; boundary=${i}`,connection:"keep-alive"},body:n}}function Se(e=16){return Array.from(Array(e)).map((()=>Math.random().toString(36)[2]||0)).join("")}const Ae=new TextEncoder;function Re(e){return"object"!=typeof e||null===e?[]:Object.entries(e).flatMap((([t,i])=>{if(Array.isArray(i))return i.flatMap((e=>Re(e)));if(i instanceof be){const r=Se();return Object.assign(e,{[t]:`attach://${r}`}),{id:r,origin:"media"===t&&"type"in e&&"string"==typeof e.type?e.type:t,file:i}}return Re(i)}))}function Ie(e,t){return Ae.encode(`content-disposition:form-data;name="${e}"\r\n\r\n${t}`)}async function*je(e,t,i){const r=i.filename||`${t}.${function(e){switch(e){case"certificate":return"pem";case"photo":case"thumbnail":return"jpg";case"voice":return"ogg";case"audio":return"mp3";case"animation":case"video":case"video_note":return"mp4";case"sticker":return"webp";default:return"dat"}}(t)}`;if(r.includes("\r")||r.includes("\n"))throw new Error(`File paths cannot contain carriage-return (\\r) or newline (\\n) characters! Filename for property '${t}' was:\n"""\n${r}\n"""`);yield Ae.encode(`content-disposition:form-data;name="${e}";filename=${r}\r\ncontent-type:application/octet-stream\r\n\r\n`);const s=await i.toRaw();s instanceof Uint8Array?yield s:yield*s}const Pe=ue("grammy:core");function Le(e,t){return(i,r,s)=>t(e,i,r,s)}class Ee{token;webhookReplyEnvelope;options;hasUsedWebhookReply;installedTransformers;constructor(e,t={},i={}){this.token=e,this.webhookReplyEnvelope=i,this.hasUsedWebhookReply=!1,this.installedTransformers=[],this.call=async(e,t,i)=>{const r=t??{};Pe(`Calling ${e}`),void 0!==i&&function(e,t,i){if("function"==typeof i?.addEventListener)return;let r=JSON.stringify(t);r.length>20&&(r=r.substring(0,16)+" ...");let s=JSON.stringify(i);throw s.length>20&&(s=s.substring(0,16)+" ..."),new Error(`Incorrect abort signal instance found! You passed two payloads to '${e}' but you should merge the second one containing '${s}' into the first one containing '${r}'! If you are using context shortcuts, you may want to use a method on 'ctx.api' instead.\n\nIf you want to prevent such mistakes in the future, consider using TypeScript. https://www.typescriptlang.org/`)}(e,r,i);const s=this.options,n=ve(r);if(void 0!==this.webhookReplyEnvelope.send&&!this.hasUsedWebhookReply&&!n&&s.canUseWebhookReply(e)){this.hasUsedWebhookReply=!0;const t=Te({...r,method:e});return await this.webhookReplyEnvelope.send(t.body),{ok:!0,result:!0}}const a=function(e){const t=new AbortController;if(void 0===e)return t;const i=e;function r(){t.abort(),i.removeEventListener("abort",r)}return i.aborted?r():i.addEventListener("abort",r),{abort:r,signal:t.signal}}(i),o=function(e,t,i){let r;return{promise:new Promise(((s,n)=>{r=setTimeout((()=>{n(new Error(`Request to '${i}' timed out after ${t} seconds`)),e.abort()}),1e3*t)})),handle:r}}(a,s.timeoutSeconds,e),h=function(e){let t=e=>{throw e};return{promise:new Promise(((i,r)=>{t=t=>{r(t),e.abort()}})),catch:t}}(a),c=s.buildUrl(s.apiRoot,this.token,e,s.environment),u=n?Fe(r,(e=>h.catch(e))):Te(r),d=a.signal,l={...s.baseFetchConfig,signal:d,...u},m=fetch(c instanceof URL?c.href:c,l).catch(function(e,t){return i=>{let r=`Network request for '${e}' failed!`;throw function(e){return"object"==typeof e&&null!==e&&"status"in e&&"statusText"in e}(i)&&(r+=` (${i.status}: ${i.statusText})`),t&&i instanceof Error&&(r+=` ${i.message}`),new le(r,i)}}(e,s.sensitiveLogs)),p=[m,h.promise,o.promise];try{const e=await Promise.race(p);return await e.json()}finally{void 0!==o.handle&&clearTimeout(o.handle)}};const r=t.apiRoot??"https://api.telegram.org",s=t.environment??"prod";if(this.options={apiRoot:r,environment:s,buildUrl:t.buildUrl??xe,timeoutSeconds:t.timeoutSeconds??500,baseFetchConfig:{...t.baseFetchConfig},canUseWebhookReply:t.canUseWebhookReply??(()=>!1),sensitiveLogs:t.sensitiveLogs??!1},this.options.apiRoot.endsWith("/"))throw new Error(`Remove the trailing '/' from the 'apiRoot' option (use '${this.options.apiRoot.substring(0,this.options.apiRoot.length-1)}' instead of '${this.options.apiRoot}')`)}call;use(...e){return this.call=e.reduce(Le,this.call),this.installedTransformers.push(...e),this}async callApi(e,t,i){const r=await this.call(e,t,i);if(r.ok)return r.result;throw function(e,t,i){return new de(`Call to '${t}' failed!`,e,t,i)}(r,e,t)}}const xe=(e,t,i,r)=>`${e}/bot${t}/${"test"===r?"test/":""}${i}`,$e={set:()=>!1,defineProperty:()=>!1,deleteProperty:()=>!1,ownKeys:()=>[]};class Qe{raw;config;constructor(e,t,i){const{raw:r,use:s,installedTransformers:n}=function(e,t,i){const r=new Ee(e,t,i),s={get:(e,t)=>"toJSON"===t?"__internal":r.callApi.bind(r,t),...$e},n={raw:new Proxy({},s),installedTransformers:r.installedTransformers,use:(...e)=>(r.use(...e),n)};return n}(e,t,i);this.raw=r,this.config={use:s,installedTransformers:()=>[...n]}}getUpdates(e,t){return this.raw.getUpdates({...e},t)}setWebhook(e,t,i){return this.raw.setWebhook({url:e,...t},i)}deleteWebhook(e,t){return this.raw.deleteWebhook({...e},t)}getWebhookInfo(e){return this.raw.getWebhookInfo(e)}getMe(e){return this.raw.getMe(e)}logOut(e){return this.raw.logOut(e)}close(e){return this.raw.close(e)}sendMessage(e,t,i,r){return this.raw.sendMessage({chat_id:e,text:t,...i},r)}forwardMessage(e,t,i,r,s){return this.raw.forwardMessage({chat_id:e,from_chat_id:t,message_id:i,...r},s)}forwardMessages(e,t,i,r,s){return this.raw.forwardMessages({chat_id:e,from_chat_id:t,message_ids:i,...r},s)}copyMessage(e,t,i,r,s){return this.raw.copyMessage({chat_id:e,from_chat_id:t,message_id:i,...r},s)}copyMessages(e,t,i,r,s){return this.raw.copyMessages({chat_id:e,from_chat_id:t,message_ids:i,...r},s)}sendPhoto(e,t,i,r){return this.raw.sendPhoto({chat_id:e,photo:t,...i},r)}sendAudio(e,t,i,r){return this.raw.sendAudio({chat_id:e,audio:t,...i},r)}sendDocument(e,t,i,r){return this.raw.sendDocument({chat_id:e,document:t,...i},r)}sendVideo(e,t,i,r){return this.raw.sendVideo({chat_id:e,video:t,...i},r)}sendAnimation(e,t,i,r){return this.raw.sendAnimation({chat_id:e,animation:t,...i},r)}sendVoice(e,t,i,r){return this.raw.sendVoice({chat_id:e,voice:t,...i},r)}sendVideoNote(e,t,i,r){return this.raw.sendVideoNote({chat_id:e,video_note:t,...i},r)}sendMediaGroup(e,t,i,r){return this.raw.sendMediaGroup({chat_id:e,media:t,...i},r)}sendLocation(e,t,i,r,s){return this.raw.sendLocation({chat_id:e,latitude:t,longitude:i,...r},s)}editMessageLiveLocation(e,t,i,r,s,n){return this.raw.editMessageLiveLocation({chat_id:e,message_id:t,latitude:i,longitude:r,...s},n)}editMessageLiveLocationInline(e,t,i,r,s){return this.raw.editMessageLiveLocation({inline_message_id:e,latitude:t,longitude:i,...r},s)}stopMessageLiveLocation(e,t,i,r){return this.raw.stopMessageLiveLocation({chat_id:e,message_id:t,...i},r)}stopMessageLiveLocationInline(e,t,i){return this.raw.stopMessageLiveLocation({inline_message_id:e,...t},i)}sendVenue(e,t,i,r,s,n,a){return this.raw.sendVenue({chat_id:e,latitude:t,longitude:i,title:r,address:s,...n},a)}sendContact(e,t,i,r,s){return this.raw.sendContact({chat_id:e,phone_number:t,first_name:i,...r},s)}sendPoll(e,t,i,r,s){return this.raw.sendPoll({chat_id:e,question:t,options:i,...r},s)}sendDice(e,t,i,r){return this.raw.sendDice({chat_id:e,emoji:t,...i},r)}setMessageReaction(e,t,i,r,s){return this.raw.setMessageReaction({chat_id:e,message_id:t,reaction:i,...r},s)}sendChatAction(e,t,i,r){return this.raw.sendChatAction({chat_id:e,action:t,...i},r)}getUserProfilePhotos(e,t,i){return this.raw.getUserProfilePhotos({user_id:e,...t},i)}getUserChatBoosts(e,t,i){return this.raw.getUserChatBoosts({chat_id:e,user_id:t},i)}getFile(e,t){return this.raw.getFile({file_id:e},t)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,t,i,r){return this.raw.banChatMember({chat_id:e,user_id:t,...i},r)}unbanChatMember(e,t,i,r){return this.raw.unbanChatMember({chat_id:e,user_id:t,...i},r)}restrictChatMember(e,t,i,r,s){return this.raw.restrictChatMember({chat_id:e,user_id:t,permissions:i,...r},s)}promoteChatMember(e,t,i,r){return this.raw.promoteChatMember({chat_id:e,user_id:t,...i},r)}setChatAdministratorCustomTitle(e,t,i,r){return this.raw.setChatAdministratorCustomTitle({chat_id:e,user_id:t,custom_title:i},r)}banChatSenderChat(e,t,i){return this.raw.banChatSenderChat({chat_id:e,sender_chat_id:t},i)}unbanChatSenderChat(e,t,i){return this.raw.unbanChatSenderChat({chat_id:e,sender_chat_id:t},i)}setChatPermissions(e,t,i){return this.raw.setChatPermissions({chat_id:e,permissions:t},i)}exportChatInviteLink(e,t){return this.raw.exportChatInviteLink({chat_id:e},t)}createChatInviteLink(e,t,i){return this.raw.createChatInviteLink({chat_id:e,...t},i)}editChatInviteLink(e,t,i,r){return this.raw.editChatInviteLink({chat_id:e,invite_link:t,...i},r)}revokeChatInviteLink(e,t,i){return this.raw.revokeChatInviteLink({chat_id:e,invite_link:t},i)}approveChatJoinRequest(e,t,i){return this.raw.approveChatJoinRequest({chat_id:e,user_id:t},i)}declineChatJoinRequest(e,t,i){return this.raw.declineChatJoinRequest({chat_id:e,user_id:t},i)}setChatPhoto(e,t,i){return this.raw.setChatPhoto({chat_id:e,photo:t},i)}deleteChatPhoto(e,t){return this.raw.deleteChatPhoto({chat_id:e},t)}setChatTitle(e,t,i){return this.raw.setChatTitle({chat_id:e,title:t},i)}setChatDescription(e,t,i){return this.raw.setChatDescription({chat_id:e,description:t},i)}pinChatMessage(e,t,i,r){return this.raw.pinChatMessage({chat_id:e,message_id:t,...i},r)}unpinChatMessage(e,t,i){return this.raw.unpinChatMessage({chat_id:e,message_id:t},i)}unpinAllChatMessages(e,t){return this.raw.unpinAllChatMessages({chat_id:e},t)}leaveChat(e,t){return this.raw.leaveChat({chat_id:e},t)}getChat(e,t){return this.raw.getChat({chat_id:e},t)}getChatAdministrators(e,t){return this.raw.getChatAdministrators({chat_id:e},t)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e,t){return this.raw.getChatMemberCount({chat_id:e},t)}getChatMember(e,t,i){return this.raw.getChatMember({chat_id:e,user_id:t},i)}setChatStickerSet(e,t,i){return this.raw.setChatStickerSet({chat_id:e,sticker_set_name:t},i)}deleteChatStickerSet(e,t){return this.raw.deleteChatStickerSet({chat_id:e},t)}getForumTopicIconStickers(e){return this.raw.getForumTopicIconStickers(e)}createForumTopic(e,t,i,r){return this.raw.createForumTopic({chat_id:e,name:t,...i},r)}editForumTopic(e,t,i,r){return this.raw.editForumTopic({chat_id:e,message_thread_id:t,...i},r)}closeForumTopic(e,t,i){return this.raw.closeForumTopic({chat_id:e,message_thread_id:t},i)}reopenForumTopic(e,t,i){return this.raw.reopenForumTopic({chat_id:e,message_thread_id:t},i)}deleteForumTopic(e,t,i){return this.raw.deleteForumTopic({chat_id:e,message_thread_id:t},i)}unpinAllForumTopicMessages(e,t,i){return this.raw.unpinAllForumTopicMessages({chat_id:e,message_thread_id:t},i)}editGeneralForumTopic(e,t,i){return this.raw.editGeneralForumTopic({chat_id:e,name:t},i)}closeGeneralForumTopic(e,t){return this.raw.closeGeneralForumTopic({chat_id:e},t)}reopenGeneralForumTopic(e,t){return this.raw.reopenGeneralForumTopic({chat_id:e},t)}hideGeneralForumTopic(e,t){return this.raw.hideGeneralForumTopic({chat_id:e},t)}unhideGeneralForumTopic(e,t){return this.raw.unhideGeneralForumTopic({chat_id:e},t)}unpinAllGeneralForumTopicMessages(e,t){return this.raw.unpinAllGeneralForumTopicMessages({chat_id:e},t)}answerCallbackQuery(e,t,i){return this.raw.answerCallbackQuery({callback_query_id:e,...t},i)}setMyName(e,t,i){return this.raw.setMyName({name:e,...t},i)}getMyName(e,t){return this.raw.getMyName(e??{},t)}setMyCommands(e,t,i){return this.raw.setMyCommands({commands:e,...t},i)}deleteMyCommands(e,t){return this.raw.deleteMyCommands({...e},t)}getMyCommands(e,t){return this.raw.getMyCommands({...e},t)}setMyDescription(e,t,i){return this.raw.setMyDescription({description:e,...t},i)}getMyDescription(e,t){return this.raw.getMyDescription({...e},t)}setMyShortDescription(e,t,i){return this.raw.setMyShortDescription({short_description:e,...t},i)}getMyShortDescription(e,t){return this.raw.getMyShortDescription({...e},t)}setChatMenuButton(e,t){return this.raw.setChatMenuButton({...e},t)}getChatMenuButton(e,t){return this.raw.getChatMenuButton({...e},t)}setMyDefaultAdministratorRights(e,t){return this.raw.setMyDefaultAdministratorRights({...e},t)}getMyDefaultAdministratorRights(e,t){return this.raw.getMyDefaultAdministratorRights({...e},t)}editMessageText(e,t,i,r,s){return this.raw.editMessageText({chat_id:e,message_id:t,text:i,...r},s)}editMessageTextInline(e,t,i,r){return this.raw.editMessageText({inline_message_id:e,text:t,...i},r)}editMessageCaption(e,t,i,r){return this.raw.editMessageCaption({chat_id:e,message_id:t,...i},r)}editMessageCaptionInline(e,t,i){return this.raw.editMessageCaption({inline_message_id:e,...t},i)}editMessageMedia(e,t,i,r,s){return this.raw.editMessageMedia({chat_id:e,message_id:t,media:i,...r},s)}editMessageMediaInline(e,t,i,r){return this.raw.editMessageMedia({inline_message_id:e,media:t,...i},r)}editMessageReplyMarkup(e,t,i,r){return this.raw.editMessageReplyMarkup({chat_id:e,message_id:t,...i},r)}editMessageReplyMarkupInline(e,t,i){return this.raw.editMessageReplyMarkup({inline_message_id:e,...t},i)}stopPoll(e,t,i,r){return this.raw.stopPoll({chat_id:e,message_id:t,...i},r)}deleteMessage(e,t,i){return this.raw.deleteMessage({chat_id:e,message_id:t},i)}deleteMessages(e,t,i){return this.raw.deleteMessages({chat_id:e,message_ids:t},i)}sendSticker(e,t,i,r){return this.raw.sendSticker({chat_id:e,sticker:t,...i},r)}getStickerSet(e,t){return this.raw.getStickerSet({name:e},t)}getCustomEmojiStickers(e,t){return this.raw.getCustomEmojiStickers({custom_emoji_ids:e},t)}uploadStickerFile(e,t,i,r){return this.raw.uploadStickerFile({user_id:e,sticker_format:t,sticker:i},r)}createNewStickerSet(e,t,i,r,s,n,a){return this.raw.createNewStickerSet({user_id:e,name:t,title:i,stickers:r,sticker_format:s,...n},a)}addStickerToSet(e,t,i,r){return this.raw.addStickerToSet({user_id:e,name:t,sticker:i},r)}setStickerPositionInSet(e,t,i){return this.raw.setStickerPositionInSet({sticker:e,position:t},i)}deleteStickerFromSet(e,t){return this.raw.deleteStickerFromSet({sticker:e},t)}setStickerEmojiList(e,t,i){return this.raw.setStickerEmojiList({sticker:e,emoji_list:t},i)}setStickerKeywords(e,t,i){return this.raw.setStickerKeywords({sticker:e,keywords:t},i)}setStickerMaskPosition(e,t,i){return this.raw.setStickerMaskPosition({sticker:e,mask_position:t},i)}setStickerSetTitle(e,t,i){return this.raw.setStickerSetTitle({name:e,title:t},i)}deleteStickerSet(e,t){return this.raw.deleteStickerSet({name:e},t)}setStickerSetThumbnail(e,t,i,r){return this.raw.setStickerSetThumbnail({name:e,user_id:t,thumbnail:i},r)}setCustomEmojiStickerSetThumbnail(e,t,i){return this.raw.setCustomEmojiStickerSetThumbnail({name:e,custom_emoji_id:t},i)}answerInlineQuery(e,t,i,r){return this.raw.answerInlineQuery({inline_query_id:e,results:t,...i},r)}answerWebAppQuery(e,t,i){return this.raw.answerWebAppQuery({web_app_query_id:e,result:t},i)}sendInvoice(e,t,i,r,s,n,a,o,h){return this.raw.sendInvoice({chat_id:e,title:t,description:i,payload:r,provider_token:s,currency:n,prices:a,...o},h)}createInvoiceLink(e,t,i,r,s,n,a,o){return this.raw.createInvoiceLink({title:e,description:t,payload:i,provider_token:r,currency:s,prices:n,...a},o)}answerShippingQuery(e,t,i,r){return this.raw.answerShippingQuery({shipping_query_id:e,ok:t,...i},r)}answerPreCheckoutQuery(e,t,i,r){return this.raw.answerPreCheckoutQuery({pre_checkout_query_id:e,ok:t,...i},r)}setPassportDataErrors(e,t,i){return this.raw.setPassportDataErrors({user_id:e,errors:t},i)}sendGame(e,t,i,r){return this.raw.sendGame({chat_id:e,game_short_name:t,...i},r)}setGameScore(e,t,i,r,s,n){return this.raw.setGameScore({chat_id:e,message_id:t,user_id:i,score:r,...s},n)}setGameScoreInline(e,t,i,r,s){return this.raw.setGameScore({inline_message_id:e,user_id:t,score:i,...r},s)}getGameHighScores(e,t,i,r){return this.raw.getGameHighScores({chat_id:e,message_id:t,user_id:i},r)}getGameHighScoresInline(e,t,i){return this.raw.getGameHighScores({inline_message_id:e,user_id:t},i)}}const Ge=ue("grammy:bot"),De=ue("grammy:warn"),Ue=ue("grammy:error"),qe=["message","edited_message","channel_post","edited_channel_post","inline_query","chosen_inline_result","callback_query","shipping_query","pre_checkout_query","poll","poll_answer","my_chat_member","chat_join_request","chat_boost","removed_chat_boost"];class We extends I{token;pollingRunning;pollingAbortController;lastTriedUpdateId;api;me;mePromise;clientConfig;ContextConstructor;observedUpdateTypes;errorHandler;constructor(e,t){if(super(),this.token=e,this.pollingRunning=!1,this.lastTriedUpdateId=0,this.observedUpdateTypes=new Set,this.errorHandler=async e=>{throw console.error("Error in middleware while handling update",e.ctx?.update?.update_id,e.error),console.error("No error handler was set!"),console.error("Set your own error handler with `bot.catch = ...`"),this.pollingRunning&&(console.error("Stopping bot"),await this.stop()),e},!e)throw new Error("Empty token!");this.me=t?.botInfo,this.clientConfig=t?.client,this.ContextConstructor=t?.ContextConstructor??w,this.api=new Qe(e,this.clientConfig)}set botInfo(e){this.me=e}get botInfo(){if(void 0===this.me)throw new Error("Bot information unavailable! Make sure to call `await bot.init()` before accessing `bot.botInfo`!");return this.me}on(e,...r){for(const[r]of t(e).flatMap(i))this.observedUpdateTypes.add(r);return super.on(e,...r)}reaction(e,...t){return this.observedUpdateTypes.add("message_reaction"),super.reaction(e,...t)}isInited(){return void 0!==this.me}async init(e){if(!this.isInited()){let t;Ge("Initializing bot"),this.mePromise??=Ne((()=>this.api.getMe(e)),e);try{t=await this.mePromise}finally{this.mePromise=void 0}void 0===this.me?this.me=t:Ge("Bot info was set by now, will not overwrite")}Ge(`I am ${this.me.username}!`)}async handleUpdates(e){for(const t of e){this.lastTriedUpdateId=t.update_id;try{await this.handleUpdate(t)}catch(e){if(!(e instanceof k))throw console.error("FATAL: grammY unable to handle:",e),e;await this.errorHandler(e)}}}async handleUpdate(e,t){if(void 0===this.me)throw new Error("Bot not initialized! Either call `await bot.init()`, or directly set the `botInfo` option in the `Bot` constructor to specify a known bot info object.");Ge(`Processing update ${e.update_id}`);const i=new Qe(this.token,this.clientConfig,t),r=this.api.config.installedTransformers();r.length>0&&i.config.use(...r);const s=new this.ContextConstructor(e,i,this.me);try{await R(this.middleware(),s)}catch(t){throw Ue(`Error in middleware for update ${e.update_id}`),new k(t,s)}}async start(e){const t=[];if(this.isInited()||t.push(this.init(this.pollingAbortController?.signal)),this.pollingRunning)return await Promise.all(t),void Ge("Simple long polling already running!");this.pollingRunning=!0,this.pollingAbortController=new AbortController,t.push(Ne((async()=>{await this.api.deleteWebhook({drop_pending_updates:e?.drop_pending_updates},this.pollingAbortController?.signal)}),this.pollingAbortController?.signal)),await Promise.all(t),await(e?.onStart?.(this.botInfo)),this.pollingRunning&&(function(e,t=qe){const i=Array.from(e).filter((e=>!t.includes(e)));i.length>0&&De(`You registered listeners for the following update types, but you did not specify them in \`allowed_updates\` so they may not be received: ${i.map((e=>`'${e}'`)).join(", ")}`)}(this.observedUpdateTypes,e?.allowed_updates),this.use=Be,Ge("Starting simple long polling"),await this.loop(e),Ge("Middleware is done running"))}async stop(){if(this.pollingRunning){Ge("Stopping bot, saving update offset"),this.pollingRunning=!1,this.pollingAbortController?.abort();const e=this.lastTriedUpdateId+1;await this.api.getUpdates({offset:e,limit:1}).finally((()=>this.pollingAbortController=void 0))}else Ge("Bot is not running!")}catch(e){this.errorHandler=e}async loop(e){const t=e?.limit,i=e?.timeout??30;let r=e?.allowed_updates??[];for(;this.pollingRunning;){const e=await this.fetchUpdates({limit:t,timeout:i,allowed_updates:r});if(void 0===e)break;await this.handleUpdates(e),r=void 0}}async fetchUpdates({limit:e,timeout:t,allowed_updates:i}){const r=this.lastTriedUpdateId+1;let s;do{try{s=await this.api.getUpdates({offset:r,limit:e,timeout:t,allowed_updates:i},this.pollingAbortController?.signal)}catch(e){await this.handlePollingError(e)}}while(void 0===s&&this.pollingRunning);return s}async handlePollingError(e){if(!this.pollingRunning)return void Ge("Pending getUpdates request cancelled");let t=3;if(e instanceof de){if(Ue(e.message),401===e.error_code)throw Ue("Make sure you are using the bot token you obtained from @BotFather (https://t.me/BotFather)."),e;if(409===e.error_code)throw Ue("Consider revoking the bot token if you believe that no other instance is running."),e;429===e.error_code&&(Ue("Bot API server is closing."),t=e.parameters.retry_after??t)}else Ue(e);Ue(`Call to getUpdates failed, retrying in ${t} seconds ...`),await Oe(t)}}async function Ne(e,t){let i=50;async function r(e){let r=!1,s="rethrow";if(e instanceof le)r=!0,s="retry";else if(e instanceof de)if(e.error_code>=500)r=!0,s="retry";else if(429===e.error_code){const n=e.parameters.retry_after;"number"==typeof n?(await Oe(n,t),i=50):r=!0,s="retry"}if(r){50!==i&&await Oe(i,t);const e=12e5;i=Math.min(e,2*i)}return s}let s={ok:!1};for(;!s.ok;)try{s={ok:!0,value:await e()}}catch(e){switch(Ue(e),await r(e)){case"retry":continue;case"rethrow":throw e}}return s.value}async function Oe(e,t){let i,r;function s(){r?.(new Error("Aborted delay")),void 0!==i&&clearTimeout(i)}try{await new Promise(((n,a)=>{r=a,t?.aborted?s():(t?.addEventListener("abort",s),i=setTimeout(n,1e3*e))}))}finally{t?.removeEventListener("abort",s)}}function Be(){throw new Error("It looks like you are registering more listeners on your bot from within other listeners! This means that every time your bot handles a message like this one, new listeners will be added. This list grows until your machine crashes, so grammY throws this error to tell you that you should probably do things a bit differently. If you're unsure how to resolve this problem, you can ask in the group chat: https://telegram.me/grammyjs\n\nOn the other hand, if you actually know what you're doing and you do need to install further middleware while your bot is running, consider installing a composer instance on your bot, and in turn augment the composer after the fact. This way, you can circumvent this protection against memory leaks.")}const Je=[...qe,"chat_member","message_reaction","message_reaction_count"],Ve={DEFAULT_UPDATE_TYPES:qe,ALL_UPDATE_TYPES:Je,ALL_CHAT_PERMISSIONS:{can_send_messages:!0,can_send_audios:!0,can_send_documents:!0,can_send_photos:!0,can_send_videos:!0,can_send_video_notes:!0,can_send_voice_notes:!0,can_send_polls:!0,can_send_other_messages:!0,can_add_web_page_previews:!0,can_change_info:!0,can_invite_users:!0,can_pin_messages:!0,can_manage_topics:!0}};Object.freeze(Ve),ue("grammy:session");const ze="X-Telegram-Bot-Api-Secret-Token";ze.toLowerCase();var He;ue("grammy:error"),He=new URL(location.href),window.PopcoinGameProxy={urlSearchInfo:He.searchParams,shareScore:function(){window&&window.TelegramGameProxy?window.TelegramGameProxy.shareScore():alert("I need to run at Telegram game environment.")},getHistory:function(){alert("Pending...")},updateGameScore:function(e){var t=new We("6811958485:AAFJdiXhF3rrV11OKzewGoaKjCoOghY1DmA"),i=this.getChatId(),r=this.getMsgId(),s=this.getTgId();i&&r&&s?t.api.setGameScore(i,r,s,e,{force:!0}).catch((function(e){console.error(e)})):(console.error("Fail to setGameScore"),console.error("p_chat_id="+i),console.error("p_msg_id="+r),console.error("p_tg_id="+s))},getChatId:function(){return this.urlSearchInfo.forEach((function(e,t){console.log(t,e)})),this.urlSearchInfo.get("p_chat_id")},getMsgId:function(){return this.urlSearchInfo.get("p_msg_id")},getTgId:function(){return this.urlSearchInfo.get("p_tg_id")}}})();